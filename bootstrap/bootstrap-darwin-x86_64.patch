118c118
< extern int* __errno_location(void);
---
> extern int* __error(void);
123c123
< #define c_errno_ENAMETOOLONG 36
---
> #define c_errno_ENAMETOOLONG 63
165c165
<    long long d_off;
---
>    unsigned long long d_seekoff;
166a167
>    unsigned short d_namlen;
168c169
<    char d_name[256];
---
>    char d_name[1024];
175c176
< dirent* readdir(DIR* dirp);
---
> dirent* readdir$INODE64(DIR* dirp);
183,184c184,187
< #define libc_fcntl_O_CREAT 0100
< #define libc_fcntl_O_TRUNC 01000
---
> #define libc_fcntl_O_NONBLOCK 04
> #define libc_fcntl_O_CREAT 01000
> #define libc_fcntl_O_TRUNC 02000
> #define libc_fcntl_O_CLOEXEC 0100000000
205,206c208,209
< extern FILE* stdout;
< extern FILE* stderr;
---
> extern FILE* __stdoutp;
> extern FILE* __stderrp;
285a289,293
> struct timespec {
>    long tv_sec;
>    long tv_nsec;
> };
> 
287c295,297
<    unsigned long st_dev;
---
>    int st_dev;
>    unsigned short st_mode;
>    unsigned short st_nlink;
289,290d298
<    unsigned long st_nlink;
<    unsigned int st_mode;
293,303c301,312
<    unsigned long st_rdev;
<    long st_size;
<    long st_blksize;
<    long st_blocks;
<    long st_atime;
<    long st_atime_nsec;
<    long st_mtime;
<    long st_mtime_nsec;
<    long st_ctime;
<    long st_ctime_nsec;
<    long reserved[3];
---
>    unsigned int st_rdev;
>    struct timespec st_atimespec;
>    struct timespec st_mtimespec;
>    struct timespec st_ctimespec;
>    struct timespec st_birthtimespec;
>    unsigned long st_size;
>    unsigned long st_blocks;
>    unsigned int st_blksize;
>    unsigned int st_flags;
>    unsigned int st_gen;
>    int st_lspare;
>    long st_qspare[2];
310,311c319,320
< int fstat(int fd, struct stat* buf);
< int stat(const char* pathname, struct stat* buf);
---
> int fstat64(int fd, struct stat* buf);
> int stat64(const char* pathname, struct stat* buf);
320c329
< typedef int64_t suseconds_t;
---
> typedef int32_t suseconds_t;
337c346
< #define sys_utsname_NAME_LEN 65
---
> #define sys_utsname_NAME_LEN 256
339,344c348,353
<    char sysname[65];
<    char nodename[65];
<    char release[65];
<    char version[65];
<    char machine[65];
<    char domainname[65];
---
>    char sysname[256];
>    char nodename[256];
>    char release[256];
>    char version[256];
>    char machine[256];
>    char domainname[256];
355c364
< #define unistd__SC_NPROCESSORS_ONLN 84
---
> #define unistd__SC_NPROCESSORS_ONLN 58
387c396
< #define pthread_SIZEOF_MUTEX_T 40
---
> #define pthread_SIZEOF_MUTEX_T 64
389c398
<    char size[40];
---
>    char size[64];
393c402
< #define pthread_SIZEOF_MUTEXATTR_T 4
---
> #define pthread_SIZEOF_MUTEXATTR_T 16
395c404
<    char size[4];
---
>    char size[16];
405c414
< #define pthread_SIZEOF_CONDATTR_T 4
---
> #define pthread_SIZEOF_CONDATTR_T 16
407c416
<    char size[4];
---
>    char size[16];
420c429
< #define dlfcn_RTLD_DEFAULT ((void*)(size_t)(0))
---
> #define dlfcn_RTLD_DEFAULT ((void*)(size_t)(-2))
2316c2325
<       fprintf(stderr, "%swarning: %s%s\n", color_Color_str(color_Yellow), buf, color_Color_str(color_Normal));
---
>       fprintf(__stderrp, "%swarning: %s%s\n", color_Color_str(color_Yellow), buf, color_Color_str(color_Normal));
2318c2327
<       fprintf(stderr, "warning: %s\n", buf);
---
>       fprintf(__stderrp, "warning: %s\n", buf);
2331c2340
<       fprintf(stderr, "%serror: %s%s\n", color_Color_str(color_Red), buf, color_Color_str(color_Normal));
---
>       fprintf(__stderrp, "%serror: %s%s\n", color_Color_str(color_Red), buf, color_Color_str(color_Normal));
2333c2342
<       fprintf(stderr, "error: %s\n", buf);
---
>       fprintf(__stderrp, "error: %s\n", buf);
2346c2355
<       fprintf(stderr, "%s%s: error: %s%s\n", color_Color_str(color_Red), loc, buf, color_Color_str(color_Normal));
---
>       fprintf(__stderrp, "%s%s: error: %s%s\n", color_Color_str(color_Red), loc, buf, color_Color_str(color_Normal));
2348c2357
<       fprintf(stderr, "%s: error: %s\n", loc, buf);
---
>       fprintf(__stderrp, "%s: error: %s\n", loc, buf);
2522c2531
<    (*__errno_location()) = c_errno_ENAMETOOLONG;
---
>    (*__error()) = c_errno_ENAMETOOLONG;
2537c2546
<    (*__errno_location()) = c_errno_ENAMETOOLONG;
---
>    (*__error()) = c_errno_ENAMETOOLONG;
2552c2561
<    (*__errno_location()) = c_errno_ENAMETOOLONG;
---
>    (*__error()) = c_errno_ENAMETOOLONG;
2567c2576
<          if (mkdir(tmp, 0777) && (*__errno_location()) != c_errno_EEXIST) return (*__errno_location());
---
>          if (mkdir(tmp, 0777) && (*__error()) != c_errno_EEXIST) return (*__error());
2570c2579
<       if (p > &tmp[512 - 2]) return (*__errno_location()) = c_errno_ENAMETOOLONG;
---
>       if (p > &tmp[512 - 2]) return (*__error()) = c_errno_ENAMETOOLONG;
2579c2588
<    return !stat(path, &statbuf);
---
>    return !stat64(path, &statbuf);
2585c2594
<    return !stat(filename, &statbuf) && (statbuf.st_mode & sys_stat_S_IFMT) == sys_stat_S_IFREG;
---
>    return !stat64(filename, &statbuf) && (statbuf.st_mode & sys_stat_S_IFMT) == sys_stat_S_IFREG;
2591c2600
<    return !stat(dirname, &statbuf) && (statbuf.st_mode & sys_stat_S_IFMT) == sys_stat_S_IFDIR;
---
>    return !stat64(dirname, &statbuf) && (statbuf.st_mode & sys_stat_S_IFMT) == sys_stat_S_IFDIR;
2660c2669
<          if ((*__errno_location()) != c_errno_EINTR) return -1;
---
>          if ((*__error()) != c_errno_EINTR) return -1;
2676c2685
<       file->error = (*__errno_location());
---
>       file->error = (*__error());
2680,2681c2689,2690
<    if (fstat(fd, &statbuf)) {
<       file->error = (*__errno_location());
---
>    if (fstat64(fd, &statbuf)) {
>       file->error = (*__error());
2704c2713
<       file->error = (*__errno_location());
---
>       file->error = (*__error());
2762c2771
<          if ((*__errno_location()) != c_errno_EINTR) return -1;
---
>          if ((*__error()) != c_errno_EINTR) return -1;
2773c2782
<       file->error = (*__errno_location());
---
>       file->error = (*__error());
2778c2787
<       file->error = (*__errno_location());
---
>       file->error = (*__error());
2938,2939c2947,2948
<       fprintf(stderr, "[exec] %s\n", msg);
<       fflush(stderr);
---
>       fprintf(__stderrp, "[exec] %s\n", msg);
>       fflush(__stderrp);
2949c2958
<       fprintf(stderr, "pipe() failed: %s\n", strerror((*__errno_location())));
---
>       fprintf(__stderrp, "pipe() failed: %s\n", strerror((*__error())));
2953c2962
<       fprintf(stderr, "fcncl(FD_CLOEXEC) failed: %s\n", strerror((*__errno_location())));
---
>       fprintf(__stderrp, "fcncl(FD_CLOEXEC) failed: %s\n", strerror((*__error())));
2960c2969
<       fprintf(stderr, "fork() failed: %s\n", strerror((*__errno_location())));
---
>       fprintf(__stderrp, "fork() failed: %s\n", strerror((*__error())));
2972c2981
<          process_utils_child_error(error_pipe[1], "cannot open output '%s': %s", filename, strerror((*__errno_location())));
---
>          process_utils_child_error(error_pipe[1], "cannot open output '%s': %s", filename, strerror((*__error())));
2975c2984
<          if ((*__errno_location()) != c_errno_EINTR) process_utils_child_error(error_pipe[1], "dup2(): %s", strerror((*__errno_location())));
---
>          if ((*__error()) != c_errno_EINTR) process_utils_child_error(error_pipe[1], "dup2(): %s", strerror((*__error())));
2982c2991
<             process_utils_child_error(error_pipe[1], "cannot change to dir '%s': %s", path, strerror((*__errno_location())));
---
>             process_utils_child_error(error_pipe[1], "cannot change to dir '%s': %s", path, strerror((*__error())));
2999c3008
<       fflush(stdout);
---
>       fflush(__stdoutp);
3001,3002c3010,3011
<       int32_t lasterr = (*__errno_location());
<       fprintf(stderr, "failed to start %s: %s\n", cmd, strerror(lasterr));
---
>       int32_t lasterr = (*__error());
>       fprintf(__stderrp, "failed to start %s: %s\n", cmd, strerror(lasterr));
3010c3019
<          fprintf(stderr, "Error reading pipe\n");
---
>          fprintf(__stderrp, "Error reading pipe\n");
3022c3031
<          fprintf(stderr, "Error waiting for pid: %s\n", strerror((*__errno_location())));
---
>          fprintf(__stderrp, "Error waiting for pid: %s\n", strerror((*__error())));
3064c3073
<       if ((size_t)len3 < size && stat(dest, &statbuf) == 0) return dest;
---
>       if ((size_t)len3 < size && stat64(dest, &statbuf) == 0) return dest;
3076c3085
<       fprintf(stderr, "pipe() failed: %s\n", strerror((*__errno_location())));
---
>       fprintf(__stderrp, "pipe() failed: %s\n", strerror((*__error())));
3080c3089
<       fprintf(stderr, "fcncl(FD_CLOEXEC) failed: %s\n", strerror((*__errno_location())));
---
>       fprintf(__stderrp, "fcncl(FD_CLOEXEC) failed: %s\n", strerror((*__error())));
3087c3096
<       fprintf(stderr, "pipe() failed: %s\n", strerror((*__errno_location())));
---
>       fprintf(__stderrp, "pipe() failed: %s\n", strerror((*__error())));
3094c3103
<       fprintf(stderr, "fork() failed: %s\n", strerror((*__errno_location())));
---
>       fprintf(__stderrp, "fork() failed: %s\n", strerror((*__error())));
3105c3114
<          if ((*__errno_location()) != c_errno_EINTR) process_utils_child_error(error_pipe[1], "dup(): %s", strerror((*__errno_location())));
---
>          if ((*__error()) != c_errno_EINTR) process_utils_child_error(error_pipe[1], "dup(): %s", strerror((*__error())));
3109c3118
<          if ((*__errno_location()) != c_errno_EINTR) process_utils_child_error(error_pipe[1], "dup2(): %s", strerror((*__errno_location())));
---
>          if ((*__error()) != c_errno_EINTR) process_utils_child_error(error_pipe[1], "dup2(): %s", strerror((*__error())));
3113c3122
<             process_utils_child_error(error_pipe[1], "cannot change to dir '%s': %s", path, strerror((*__errno_location())));
---
>             process_utils_child_error(error_pipe[1], "cannot change to dir '%s': %s", path, strerror((*__error())));
3129,3130c3138,3139
<       int32_t lasterr = (*__errno_location());
<       fprintf(stderr, "failed to start %s: %s\n", cmd, strerror(lasterr));
---
>       int32_t lasterr = (*__error());
>       fprintf(__stderrp, "failed to start %s: %s\n", cmd, strerror(lasterr));
3139c3148
<          fprintf(stderr, "Error reading pipe\n");
---
>          fprintf(__stderrp, "Error reading pipe\n");
3154c3163
<          fprintf(stderr, "Error waiting for pid: %s\n", strerror((*__errno_location())));
---
>          fprintf(__stderrp, "Error waiting for pid: %s\n", strerror((*__error())));
3167c3176
<             fprintf(stderr, "error reading process output\n");
---
>             fprintf(__stderrp, "error reading process output\n");
3180c3189
<          fprintf(stderr, "child exited ABNORMALLY\n");
---
>          fprintf(__stderrp, "child exited ABNORMALLY\n");
3371c3380
<          fprintf(stderr, "%s%serror:%s cannot open %s: %s\n", tmp, color_Color_str(color_Red), color_Color_str(color_Normal), filename, file_utils_File_getError(&file));
---
>          fprintf(__stderrp, "%s%serror:%s cannot open %s: %s\n", tmp, color_Color_str(color_Red), color_Color_str(color_Normal), filename, file_utils_File_getError(&file));
3373c3382
<          fprintf(stderr, "%serror: cannot open %s: %s\n", tmp, filename, file_utils_File_getError(&file));
---
>          fprintf(__stderrp, "%serror: cannot open %s: %s\n", tmp, filename, file_utils_File_getError(&file));
3814c3823
<       if (stat(constants_recipe_name, &buf)) {
---
>       if (stat64(constants_recipe_name, &buf)) {
3816c3825
<          if ((*__errno_location()) != c_errno_ENOENT) {
---
>          if ((*__error()) != c_errno_ENOENT) {
3843c3852
<    int32_t error = stat(constants_buildfile_name, &buf);
---
>    int32_t error = stat64(constants_buildfile_name, &buf);
4001c4010
<          fprintf(stderr, "[build-file] warning: environment variable '%s' not set!\n", raw + 1);
---
>          fprintf(__stderrp, "[build-file] warning: environment variable '%s' not set!\n", raw + 1);
4048c4057
<             fprintf(stderr, "[build-file] missing options for %s\n", name);
---
>             fprintf(__stderrp, "[build-file] missing options for %s\n", name);
4066c4075
<       fprintf(stderr, "Error: %s\n", yaml_Parser_getMessage(parser));
---
>       fprintf(__stderrp, "Error: %s\n", yaml_Parser_getMessage(parser));
8012c8021
< static const char git_version_Describe[9] = "13c3112b";
---
> static const char git_version_Describe[15] = "13c3112b-dirty";
20799c20808
<             fprintf(stderr, "function prototype not supported: %s\n", ast_FunctionDecl_getCName(fd));
---
>             fprintf(__stderrp, "function prototype not supported: %s\n", ast_FunctionDecl_getCName(fd));
21717c21726
<    fputs(string_buffer_Buf_data(out), stderr);
---
>    fputs(string_buffer_Buf_data(out), __stderrp);
21748c21757
<       fputs(string_buffer_Buf_data(out), stderr);
---
>       fputs(string_buffer_Buf_data(out), __stderrp);
23696c23705
<       fprintf(stderr, "%s: %serror:%s %s\n", locstr, color_Color_str(color_Red), color_Color_str(color_Normal), msg);
---
>       fprintf(__stderrp, "%s: %serror:%s %s\n", locstr, color_Color_str(color_Red), color_Color_str(color_Normal), msg);
23698c23707
<       fprintf(stderr, "%s: error: %s\n", locstr, msg);
---
>       fprintf(__stderrp, "%s: error: %s\n", locstr, msg);
23714c23723
<       fprintf(stderr, "%s: %swarning:%s %s\n", locstr, color_Color_str(color_Red), color_Color_str(color_Normal), msg);
---
>       fprintf(__stderrp, "%s: %swarning:%s %s\n", locstr, color_Color_str(color_Red), color_Color_str(color_Normal), msg);
23716c23725
<       fprintf(stderr, "%s: warning: %s\n", locstr, msg);
---
>       fprintf(__stderrp, "%s: warning: %s\n", locstr, msg);
35690c35699
<       fprintf(stderr, "error: missing node %s\n", path);
---
>       fprintf(__stderrp, "error: missing node %s\n", path);
35717c35726
<          fprintf(stderr, "error in manifest: invalid library kind '%s'\n", kind);
---
>          fprintf(__stderrp, "error in manifest: invalid library kind '%s'\n", kind);
35723c35732
<       fprintf(stderr, "error in manifest: a library must be dynamic static and/or source\n");
---
>       fprintf(__stderrp, "error in manifest: a library must be dynamic static and/or source\n");
35732c35741
<       fprintf(stderr, "manifest: a source library must have c2 as language\n");
---
>       fprintf(__stderrp, "manifest: a source library must have c2 as language\n");
35748c35757
<          fprintf(stderr, "manifest: sources are only allowed for source library kind\n");
---
>          fprintf(__stderrp, "manifest: sources are only allowed for source library kind\n");
35753c35762
<          fprintf(stderr, "manifest: sources are required for source library kind\n");
---
>          fprintf(__stderrp, "manifest: sources are required for source library kind\n");
35821c35830
< static const char* plugin_mgr_lib_ext = ".so";
---
> static const char* plugin_mgr_lib_ext = ".dylib";
35902c35911
<          console_warn("cannot read '%s': %s", path, strerror((*__errno_location())));
---
>          console_warn("cannot read '%s': %s", path, strerror((*__error())));
35907c35916
<          while ((entry = readdir(dir))) {
---
>          while ((entry = readdir$INODE64(dir))) {
38213c38222
<       console_error("cannot create directory %s: %s", dir, strerror((*__errno_location())));
---
>       console_error("cannot create directory %s: %s", dir, strerror((*__error())));
38273c38282
<       console_error("cannot launch C compilation: %s", strerror((*__errno_location())));
---
>       console_error("cannot launch C compilation: %s", strerror((*__error())));
39694c39703
<       console_error("cannot copy file to %s: %s", dest, strerror((*__errno_location())));
---
>       console_error("cannot copy file to %s: %s", dest, strerror((*__error())));
41939c41948
<    fputs(string_buffer_Buf_data(out), stdout);
---
>    fputs(string_buffer_Buf_data(out), __stdoutp);
45056,45057c45065,45066
<    ir_context_WorkQueue* q = malloc(64);
<    memset(q, 0, 64);
---
>    ir_context_WorkQueue* q = malloc(88);
>    memset(q, 0, 88);
45971c45980
<       console_error("cannot create directory %s: %s", ir_dir, strerror((*__errno_location())));
---
>       console_error("cannot create directory %s: %s", ir_dir, strerror((*__error())));
47700c47709
<       console_error("cannot create directory %s: %s", info->output_dir, strerror((*__errno_location())));
---
>       console_error("cannot create directory %s: %s", info->output_dir, strerror((*__error())));
47896c47905
<       console_error("error getting system info: %s", strerror((*__errno_location())));
---
>       console_error("error getting system info: %s", strerror((*__error())));
48153c48162
<       console_error("cannot open library dir '%s': %s", dirname, strerror((*__errno_location())));
---
>       console_error("cannot open library dir '%s': %s", dirname, strerror((*__error())));
48158c48167
<       while ((entry = readdir(dir))) {
---
>       while ((entry = readdir$INODE64(dir))) {
48729c48738
<          console_error("c2c: cannot chdir to %s: %s", c->opts.other_dir, strerror((*__errno_location())));
---
>          console_error("c2c: cannot chdir to %s: %s", c->opts.other_dir, strerror((*__error())));
